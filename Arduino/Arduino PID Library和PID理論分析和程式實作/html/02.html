<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0089)http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<title>Improving the Beginner’s PID – Sample Time «  Project  Blog</title>

<link rel="stylesheet" href="./02_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Project  Blog RSS Feed" href="http://brettbeauregard.com/blog/feed/">
<link rel="alternate" type="application/atom+xml" title="Project  Blog Atom Feed" href="http://brettbeauregard.com/blog/feed/atom/">
<link rel="pingback" href="http://brettbeauregard.com/blog/xmlrpc.php">

<style type="text/css" media="screen">

	#page { background: url("http://brettbeauregard.com/blog/wp-content/themes/default/images/kubrickbgwide.jpg") repeat-y top; border: none; }

</style>



            <script type="text/javascript" async="" src="./02_files/ga.js"></script><script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.3 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-9013272-1']);
				            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
			<link rel="alternate" type="application/rss+xml" title="Project  Blog » Improving the Beginner’s PID – Sample Time Comments Feed" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/brettbeauregard.com\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./02_files/wp-emoji-release.min.js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="thingiverse_style-css" href="./02_files/style(1).css" type="text/css" media="all">
<script type="text/javascript" src="./02_files/jquery.js"></script>
<script type="text/javascript" src="./02_files/jquery-migrate.min.js"></script>
<link rel="https://api.w.org/" href="http://brettbeauregard.com/blog/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://brettbeauregard.com/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://brettbeauregard.com/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Improving the Beginner’s PID – Introduction" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-introduction/">
<link rel="next" title="Improving the Beginner’s PID – Derivative Kick" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-derivative-kick/">
<meta name="generator" content="WordPress 4.5">
<link rel="canonical" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/">
<link rel="shortlink" href="http://brettbeauregard.com/blog/?p=762">
<link rel="alternate" type="application/json+oembed" href="http://brettbeauregard.com/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginner%25e2%2580%2599s-pid-sample-time%2F">
<link rel="alternate" type="text/xml+oembed" href="http://brettbeauregard.com/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginner%25e2%2580%2599s-pid-sample-time%2F&amp;format=xml">
<link rel="payment" type="text/html" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=br3ttb&amp;popout=1&amp;url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginner%25e2%2580%2599s-pid-sample-time%2F&amp;language=en_GB&amp;category=text&amp;title=Improving+the+Beginner%E2%80%99s+PID+%26%238211%3B+Sample+Time&amp;description=Project+updates+and...+um...&amp;tags=Arduino%2CBeginner%27s+PID%2CPID%2Cblog">
<link rel="stylesheet" type="text/css" href="./02_files/shCore.css"><link rel="stylesheet" type="text/css" href="./02_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
</head>
<body>
<div id="page">


<div id="header">
	<div id="headerimg">
		<h1><a href="http://brettbeauregard.com/blog/">Project  Blog</a></h1>
		<div class="description">Project updates and… um…</div>
	</div>
</div>
<hr>

	<div id="content" class="narrowcolumn">

	
		<div class="navigation">
			<div class="alignleft">« <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-introduction/" rel="prev">Improving the Beginner’s PID – Introduction</a></div>
			<div class="alignright"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-derivative-kick/" rel="next">Improving the Beginner’s PID – Derivative Kick</a> »</div>
		</div>

		<div class="post-762 post type-post status-publish format-standard hentry category-coding category-pid tag-arduino tag-beginners-pid tag-pid author-admin" id="post-762">
			<h2>Improving the Beginner’s PID – Sample Time</h2>

			<div class="entry">
				<p><small>(This is Modification #1 in a <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/improving-the-beginners-pid-introduction">larger series</a> on writing a solid PID algorithm)</small></p>
<h3>The Problem</h3>
<p>The Beginner’s PID is designed to be called irregularly.  This causes 2 issues:</p>
<ul>
<li>You don’t get consistent behavior from the PID, since sometimes it’s called frequently and sometimes it’s not.</li>
<li>You need to do extra math computing the derivative and integral, since they’re both dependent on the change in time.</li>
</ul>
<h3>The Solution</h3>
<p>Ensure that the PID is called at a regular interval.  The way I’ve decided to do this is to specify that the compute function get called every cycle.  based on a pre-determined Sample Time, the PID decides if it should compute or return immediately.</p>
<p>Once we know that the PID is being evaluated at a constant interval, the derivative and integral calculations can also be simplified.  Bonus!</p>
<h3>The Code</h3>
<div><div id="highlighter_787493" class="syntaxhighlighter  css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1 highlighted">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1 highlighted">10</div><div class="line number11 index10 alt2 highlighted">11</div><div class="line number12 index11 alt1 highlighted">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2 highlighted">15</div><div class="line number16 index15 alt1 highlighted">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1 highlighted">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2 highlighted">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2 highlighted">31</div><div class="line number32 index31 alt1 highlighted">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2 highlighted">35</div><div class="line number36 index35 alt1 highlighted">36</div><div class="line number37 index36 alt2 highlighted">37</div><div class="line number38 index37 alt1 highlighted">38</div><div class="line number39 index38 alt2 highlighted">39</div><div class="line number40 index39 alt1 highlighted">40</div><div class="line number41 index40 alt2 highlighted">41</div><div class="line number42 index41 alt1 highlighted">42</div><div class="line number43 index42 alt2 highlighted">43</div><div class="line number44 index43 alt1 highlighted">44</div><div class="line number45 index44 alt2 highlighted">45</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css comments">/*working variables*/</code></div><div class="line number2 index1 alt1"><code class="css plain">unsigned long lastTime;</code></div><div class="line number3 index2 alt2"><code class="css value">double</code> <code class="css plain">Input, Output, Setpoint;</code></div><div class="line number4 index3 alt1"><code class="css value">double</code> <code class="css plain">errSum, lastErr;</code></div><div class="line number5 index4 alt2"><code class="css value">double</code> <code class="css plain">kp, ki, kd;</code></div><div class="line number6 index5 alt1 highlighted"><code class="css plain">int SampleTime = </code><code class="css value">1000</code><code class="css plain">; //</code><code class="css value">1</code> <code class="css plain">sec</code></div><div class="line number7 index6 alt2"><code class="css plain">void Compute()</code></div><div class="line number8 index7 alt1"><code class="css plain">{</code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">unsigned long now = millis();</code></div><div class="line number10 index9 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">int timeChange = (now - lastTime);</code></div><div class="line number11 index10 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(timeChange&gt;=SampleTime)</code></div><div class="line number12 index11 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">{</code></div><div class="line number13 index12 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Compute all the working error variables*/</code></div><div class="line number14 index13 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">error = Setpoint - Input;</code></div><div class="line number15 index14 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">errSum += error;</code></div><div class="line number16 index15 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">dErr = (error - lastErr);</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Compute PID Output*/</code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">Output = kp * error + ki * errSum + kd * dErr;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Remember some variables for next time*/</code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">lastErr = error;</code></div><div class="line number23 index22 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">lastTime = now;</code></div><div class="line number24 index23 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number25 index24 alt2"><code class="css plain">}</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="css plain">void SetTunings(</code><code class="css value">double</code> <code class="css plain">Kp, </code><code class="css value">double</code> <code class="css plain">Ki, </code><code class="css value">double</code> <code class="css plain">Kd)</code></div><div class="line number28 index27 alt1"><code class="css plain">{</code></div><div class="line number29 index28 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">SampleTimeInSec = ((</code><code class="css value">double</code><code class="css plain">)SampleTime)/</code><code class="css value">1000</code><code class="css plain">;</code></div><div class="line number30 index29 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">kp = Kp;</code></div><div class="line number31 index30 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">ki = Ki * SampleTimeInSec;</code></div><div class="line number32 index31 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">kd = Kd / SampleTimeInSec;</code></div><div class="line number33 index32 alt2"><code class="css plain">}</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2 highlighted"><code class="css plain">void SetSampleTime(int NewSampleTime)</code></div><div class="line number36 index35 alt1 highlighted"><code class="css plain">{</code></div><div class="line number37 index36 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if (NewSampleTime &gt; </code><code class="css value">0</code><code class="css plain">)</code></div><div class="line number38 index37 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">{</code></div><div class="line number39 index38 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">ratio&nbsp; = (</code><code class="css value">double</code><code class="css plain">)NewSampleTime</code></div><div class="line number40 index39 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">/ (</code><code class="css value">double</code><code class="css plain">)SampleTime;</code></div><div class="line number41 index40 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">ki *= ratio;</code></div><div class="line number42 index41 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">kd /= ratio;</code></div><div class="line number43 index42 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">SampleTime = (unsigned long)NewSampleTime;</code></div><div class="line number44 index43 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number45 index44 alt2 highlighted"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>On lines 10&amp;11, the algorithm now decides for itself if it’s time to calculate.  Also, because we now KNOW that it’s going to be the same time between samples, we don’t need to constantly multiply by time change.  We can merely adjust the Ki and Kd appropriately (lines 31 &amp; 32) and result is mathematically equivalent, but more efficient.</p>
<p>one little wrinkle with doing it this way though though.  if the user decides to change the sample time during operation, the Ki and Kd will need to be re-tweaked to reflect this new change.  that’s what lines 39-42 are all about.</p>
<p>Also Note that I convert the sample time to Seconds on line 29.  Strictly speaking this isn’t necessary,  but allows the user to enter Ki and Kd in units of 1/sec and s, rather than 1/mS and mS.</p>
<h3>The Results</h3>
<p>the changes above do 3 things for us</p>
<ol>
<li>Regardless of how frequently Compute() is called, the PID algorithm will be evaluated at a regular interval [Line 11]</li>
<li>Because of the time subtraction [Line 10] there will be no issues when millis() wraps back to 0.  That only happens every 55 days, but we’re going for bulletproof remember?</li>
<li>We don’t need to multiply and divide by the timechange anymore.  Since it’s a constant we’re able to move it from the compute code [lines 15+16] and lump it in with the tuning constants [lines 31+32].  Mathematically it works out the same, but it saves a multiplication and a division every time the PID is evaluated</li>
</ol>
<h3> Side note about interrupts</h3>
<p>If this PID is going into a microcontroller, a very good argument can be made for using an interrupt.  SetSampleTime sets the interrupt frequency, then Compute gets called when it’s time.  There would be no need, in that case, for lines 9-12, 23, and 24.  If you plan on doing this with your PID implentation, go for it!  Keep reading this series though. You’ll hopefully still get some benefit from the modifications that follow.<br>
There are three reasons I didn’t use interrupts</p>
<ol>
<li>As far as this series is concerned, not everyone will be able to use interrupts.</li>
<li>Things would get tricky if you wanted it implement many PID controllers at the same time.</li>
<li>If I’m honest, it didn’t occur to me.  <a href="http://jimmieprodgers.com/">Jimmie Rodgers</a> suggested it while proof-reading the series for me.  I may decide to use interrupts in future versions of the PID library.</li>
</ol>
<p><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/improving-the-beginner%E2%80%99s-pid-derivative-kick">Next &gt;&gt;</a><br>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img style="border-width: 0" src="./02_files/80x15.png" alt="Creative Commons License"></a></p>
<p class="wp-flattr-button"><a href="http://brettbeauregard.com/blog/?flattrss_redirect&amp;id=762&amp;md5=bf4c0ede2f791349d94475a3a7fefad4" title="Flattr" target="_blank"><img src="./02_files/flattr-badge-large.png" alt="flattr this!"></a></p>
								<p>Tags: <a href="http://brettbeauregard.com/blog/tag/arduino/" rel="tag">Arduino</a>, <a href="http://brettbeauregard.com/blog/tag/beginners-pid/" rel="tag">Beginner's PID</a>, <a href="http://brettbeauregard.com/blog/tag/pid/" rel="tag">PID</a></p>
				<p class="postmetadata alt">
					<small>
						This entry was posted
												on Friday, April 15th, 2011 at 3:01 pm						and is filed under <a href="http://brettbeauregard.com/blog/category/pid/coding/" rel="category tag">Coding</a>, <a href="http://brettbeauregard.com/blog/category/pid/" rel="category tag">PID</a>.
						You can follow any responses to this entry through the <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/feed/">RSS 2.0</a> feed.

													You can <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#respond">leave a response</a>, or <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/trackback/" rel="trackback">trackback</a> from your own site.

						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">23 Responses to “Improving the Beginner’s PID – Sample Time”</h3>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1" id="comment-13474">
				<div id="div-comment-13474" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/687f5af10e83dbe09fbef53df89bec7f" srcset="http://0.gravatar.com/avatar/687f5af10e83dbe09fbef53df89bec7f?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Coding Badly</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-13474">
			April 16, 2011 at 3:27 am</a>		</div>

		<p>I think moving the time calculations out of Compute is a good idea but it does create a potential pitfall for new users.  The calculations will not be accurate if more than SampleTime has elapsed between calls.  This could be difficult (or impossible) to debug.  I suggest adding a check for “(grossly) exceeded SampleTime”.  If the SampleTime has been exceeded, set a flag.  This gives the user a convenient way to check for an overrun.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-13489">
				<div id="div-comment-13489" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-13489">
			April 16, 2011 at 7:48 am</a>		</div>

		<p>That’s definitely a issue that can arise.  I hate flags, but that may be the best solution.  I’ll have to think about it some more.  Until then we’ll just have to keep our eye out for people reporting suspicious performance degradation. “…then I set my sample time to 1mS”  AHA!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-18402">
				<div id="div-comment-18402" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/ebdde6ffbf6c5539711ded4b1b1233c1" srcset="http://2.gravatar.com/avatar/ebdde6ffbf6c5539711ded4b1b1233c1?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://google/" rel="external nofollow" class="url">prashant</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18402">
			July 16, 2011 at 1:33 pm</a>		</div>

		<p>how much is ur blog applicable for a line follower robot (with 5 digital sensors) as it is?<br>
i mean wat changes we may hv to do ? apart from our own algorithm language n al?</p>
<p>to be specific i hv 3 major questions<br>
1) is SetTunings method required for us?i mean til now we thot kp,ki,kd are constants and we ll give them values?n they shouldnt change their values in between right?</p>
<p>2)how exactly to call compute method after certain time (say 1ms) from main ?<br>
u hvnt specified it on how to call it from main? n is millis() method used for it?</p>
<p>n lastly</p>
<p>3)how we relate output/correction with speed of motors (2)? we know that we ll hv to use PWM. we know how to do it. but we want ur word on this.</p>
<p>we ll be grateful for ur help. ty</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-18662">
				<div id="div-comment-18662" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a6231d2d4e715e75558e6e43c7bfda2a" srcset="http://1.gravatar.com/avatar/a6231d2d4e715e75558e6e43c7bfda2a?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">somun</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18662">
			July 21, 2011 at 4:07 pm</a>		</div>

		<p>Thanks for the write up Brett!</p>
<p>One point that I have trouble understanding is the 2nd result you mention. Looks to me that your argument regarding being safe for timer wrapping to 0, does not hold. Say the lastTime is just 1 second below wrapping to zero and now() returns, say 2. Than timeChange would be a negative number which would evaluate to false in the if statement. What am I missing?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-18664">
				<div id="div-comment-18664" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18664">
			July 21, 2011 at 4:30 pm</a>		</div>

		<p>Somun, the trick is that now is an UNSIGNED long.  so rather than having negative numbers it uses that space to allow for larger positive numbers.  when you subtract 5 from 2 say, the result isn’t -3, it’s 4,294,967,292.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-18688">
				<div id="div-comment-18688" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a6231d2d4e715e75558e6e43c7bfda2a" srcset="http://1.gravatar.com/avatar/a6231d2d4e715e75558e6e43c7bfda2a?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">somun</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18688">
			July 22, 2011 at 12:57 am</a>		</div>

		<p>I think that’s not the case unless timeChange is defined as unsigned, too (it’s an int in the code). Just tried on Visual Studio.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-18709">
				<div id="div-comment-18709" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18709">
			July 22, 2011 at 6:59 am</a>		</div>

		<p>ah.  with a different programming language your mileage may vary.  thanks for the rigorous testing!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-18730">
				<div id="div-comment-18730" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/cc6e5462ce7562c0939a83965ea45329" srcset="http://0.gravatar.com/avatar/cc6e5462ce7562c0939a83965ea45329?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">David</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18730">
			July 22, 2011 at 11:27 am</a>		</div>

		<p>Jimmie Rogers is absolutely right about using interrupts.  Calling from the main loop will only give you consistent timing if you have plenty of processing margin.  For robustness you really want to make sure that any time critical code (such as a control loop) is called from a timer interrupt.  None time sensitive code can then be left in the main loop and it doesn’t matter if it overruns.</p>
<p>You are correct though; it is much, much harder to have multiple PIDs without hard-coding them in.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-18732">
				<div id="div-comment-18732" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18732">
			July 22, 2011 at 11:40 am</a>		</div>

		<p>Yeah I was thinking the best solution might be to have a common interrupt set to the lowest common denominator of the sample time of the various pid loops, then using that to decide which pid needed to be computed when.  But I just don’t have that kind of AVR skill.  I felt I needed to include that though, because somebody is reading this right now and saying “well that’s easy!  let me whip that up”</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-18737">
				<div id="div-comment-18737" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a6231d2d4e715e75558e6e43c7bfda2a" srcset="http://1.gravatar.com/avatar/a6231d2d4e715e75558e6e43c7bfda2a?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">somun</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18737">
			July 22, 2011 at 12:52 pm</a>		</div>

		<p>@Brett. Well last time I checked Visual Studio was an IDE <img draggable="false" class="emoji" alt="🙂" src="./02_files/1f642.png"></p>
<p>Anyway, it is just C/C++ behavior (Arduino compiler is a branch of gcc). When that non-negative big number is put into an int, it becomes negative due to the way 2’s complement works. Please go ahead and verify if you don’t believe me. ‘timeChange’ needs to be unsigned.</p>
<p>Sorry for insisting on a small issue in a great write-up but I guess I am just trying to contribute to the bullet-proofness <img draggable="false" class="emoji" alt="🙂" src="./02_files/1f642.png"></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-18739">
				<div id="div-comment-18739" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/034655ea7b1f60326519b0817b7fcfe8" srcset="http://0.gravatar.com/avatar/034655ea7b1f60326519b0817b7fcfe8?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Eric Anderson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18739">
			July 22, 2011 at 1:06 pm</a>		</div>

		<p>Regarding result 2:</p>
<p>If timeChange can become negative at wrap time due to conversion from unsigned to signed as stated above, the code will not just miss computing a pid, the code would permanently stop adjusting the output value.</p>
<p>If timeChange is just made large when time wraps back to 0, then you may have  an iteration where the output changes on a short cycle.  Exactly how short would depend on the relationship between sampleTime and the the size of long.  (ie. what is MAXLONG % sampleTime).</p>
<p>I agree that an interrupt based solution is better, to remove or simplify the time keeping code in the PID.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-18740">
				<div id="div-comment-18740" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18740">
			July 22, 2011 at 1:15 pm</a>		</div>

		<p>interesting.  I tested this feature by making now = millis()+ 4294960000 and letting it run, and there were no issues.</p>
<p>wait.  I think I know what happened.  the timeChange variable was added for clarification during this explanation.  initially I just had the subtraction inside the if statement.  that would do it.  good call guys.  will need to change that to an unsigned long in the next iteration of the library.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-18746">
				<div id="div-comment-18746" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/034655ea7b1f60326519b0817b7fcfe8" srcset="http://0.gravatar.com/avatar/034655ea7b1f60326519b0817b7fcfe8?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Eric Anderson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-18746">
			July 22, 2011 at 2:35 pm</a>		</div>

		<p>How did you check?  If the value goes negative, what you would see is that the output would stick on a value.  Otherwise, you will get one output generated that is out of sync with your time interval (and the subsequent updates would be at the correct interval, but not in line with the previous updates).</p>
<p>It all depends on how closely you need to track the time based part of the PID.</p>
<p>With the code as it is (ignoring the wraparound issue), it assumes but does not force regularity.  The logic says update the output if at least time interval has passed, but it computes the PID as if exactly time interval has passed.</p>
<p>This may or may not be an issue depending on what it is you are controlling and how close the actual time elapsed is to the time interval.</p>
<p>B.T.W. – I really do appreciate this PID overview.  I am always on the look out for such things to help with training I do for FIRST robotics teams.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-21969">
				<div id="div-comment-21969" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/7766dbfbc5870a06fc6d780d9fd1e25b" srcset="http://1.gravatar.com/avatar/7766dbfbc5870a06fc6d780d9fd1e25b?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://home.swipnet.se/triumph/" rel="external nofollow" class="url">Krille</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-21969">
			September 19, 2011 at 6:17 am</a>		</div>

		<p>Nice…<br>
But I think if you add an “Window value” the library will be perfect<br>
If you use an servo the regulating of the servo can damiched the feedback potentiometer if you regulate to often.. So if I can have a which I wold love to have a window value… Else I will add it by my self.. <img draggable="false" class="emoji" alt="🙂" src="./02_files/1f642.png"></p>
<p>Best regards<br>
Krille</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-30810">
				<div id="div-comment-30810" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/5de8902462fb0a99b194c2e340432fc6" srcset="http://2.gravatar.com/avatar/5de8902462fb0a99b194c2e340432fc6?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Jason C</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-30810">
			January 2, 2012 at 10:59 am</a>		</div>

		<p>While on the topic of sampling time, I am wondering what are the effects different sampling time have on the performance of the PID control algorithm. e.g. Do you like reach stabilization faster with a shorter sampling time?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-30811">
				<div id="div-comment-30811" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-30811">
			January 2, 2012 at 11:13 am</a>		</div>

		<p>@Jason, if your sampling time is too slow it will certainly impact loop performance.  as it gets faster, you will notice improvement up to a point.  after this the performance will be virtually identical regardless of sample time.  the value at which this occurs will be different for each system.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-30960">
				<div id="div-comment-30960" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/fcec724798637c838808350a11ee0844" srcset="http://0.gravatar.com/avatar/fcec724798637c838808350a11ee0844?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Thomas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-30960">
			January 3, 2012 at 3:14 pm</a>		</div>

		<p>Hello Brett,</p>
<p>Thank you very much for writing such a great library and tutorial! I suppose in line 10 the expression will become negative when the overflow of millis() occurs:<br>
 int timeChange = (now – lastTime)  0:<br>
if(timeChange&gt;=SampleTime)<br>
Maybe you had an unsigned long for timeChange in mind, then it should work out:<br>
 unsigned long timeChange = (now – lastTime)  &gt;0<br>
Cheers, Thomas</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-30961">
				<div id="div-comment-30961" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-30961">
			January 3, 2012 at 3:18 pm</a>		</div>

		<p>@Thomas Yup.  there’s a discussion to that effect a little further up the comment chain.  The PID Library code has been updated</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-30962">
				<div id="div-comment-30962" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/fcec724798637c838808350a11ee0844" srcset="http://0.gravatar.com/avatar/fcec724798637c838808350a11ee0844?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Thomas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-30962">
			January 3, 2012 at 3:18 pm</a>		</div>

		<p>Sorry, there was missing something in my last comment. There should be written:<br>
I suppose in line 10 the expression will become negative when the overflow of millis() occurs:<br>
int timeChange = (now – lastTime) &lt;0<br>
In this case the execution of the controller in line 11 will never happen, because 0=SampleTime)<br>
Maybe you had an unsigned long for timeChange in mind, then it should work out:<br>
unsigned long timeChange = (now – lastTime) &gt;0<br>
Cheers, Thomas</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-33886">
				<div id="div-comment-33886" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/682157bbfc6d0ea27fd8cef529995da8" srcset="http://0.gravatar.com/avatar/682157bbfc6d0ea27fd8cef529995da8?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pid_hobby</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-33886">
			February 5, 2012 at 5:19 am</a>		</div>

		<p>We can merely adjust the Ki and Kd appropriately (lines 30&amp;31) and result is mathematically equivalent, but more efficient.</p>
<p>error  lines 30&amp; 31 </p>
<p>to :<br>
 lines 31 &amp; 32</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-33897">
				<div id="div-comment-33897" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-33897">
			February 5, 2012 at 8:37 am</a>		</div>

		<p>@pid_hobby fixed thanks</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-77745">
				<div id="div-comment-77745" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/964a45dde01b7c3f60992a04bcbb89d1" srcset="http://0.gravatar.com/avatar/964a45dde01b7c3f60992a04bcbb89d1?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">DG</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-77745">
			October 9, 2012 at 1:03 pm</a>		</div>

		<p>Brett, how important is it that the algorithm be called on a regular schedule?  I’m planning on using your algorithm in an environment (Android) that can’t guarantee that it will be called with millisecond accuracy.  If the SampleTime is 15 s but there is a 16 s difference between calls wll this seriously affect the PID accuracy?  Thanks.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-77747">
				<div id="div-comment-77747" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./02_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#comment-77747">
			October 9, 2012 at 1:09 pm</a>		</div>

		<p>@DG the variation you describe wouldn’t have a HUGE impact, and subsequent evaluations would correct mistakes made earlier on.  it wouldn’t be 100% repeatable however, which can sometimes be a big issue.  if you think this might be a big deal, you could leave in the time divisions I remove in this step.</p>

		
				</div>
		</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
 


<div id="respond">

<h3>Leave a Reply</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-sample-time/#respond" style="display:none;">Click here to cancel reply.</a></small>
</div>


<form action="http://brettbeauregard.com/blog/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" aria-required="true">
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" aria-required="true">
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;s&gt; &lt;strike&gt; &lt;strong&gt; </code></small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment">
<input type="hidden" name="comment_post_ID" value="762" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="e7fddab711"></p>
</form>

</div>


	
	</div>
 	<div id="sidebar">
		<ul>
						<li>
				<form role="search" method="get" id="searchform" class="searchform" action="http://brettbeauregard.com/blog/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form>			</li>

			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Author</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			
		

			
				<li id="linkcat-3" class="linkcat"><h2>Links</h2>
	<ul class="xoxo blogroll">
<li><a href="http://groups.google.com/group/diy-pid-control/" title="PID Control Google Group"><img src="./02_files/diy-pid-control-link.jpg" alt="DIY PID Control" title="PID Control Google Group"></a></li>
<li><a href="http://www.ospid.com/blog/" title="osPID: The Open-Source PID controller"><img src="./02_files/osPID-Link.jpg" alt="osPID" title="osPID: The Open-Source PID controller"></a></li>
<li><a href="http://www.thingiverse.com/br3ttb" title="My Thingiverse Profile"><img src="./02_files/printed_portrait-small.jpg" alt="Thingiverse Profile" title="My Thingiverse Profile"></a></li>

	</ul>
</li>
<li id="linkcat-8" class="linkcat"><h2>This Site</h2>
	<ul class="xoxo blogroll">
<li><a href="http://brettbeauregard.com/about.html">About</a></li>
<li><a href="http://brettbeauregard.com/projects/" rel="me">Project Index</a></li>

	</ul>
</li>

	
			

			<li class="categories"><h2>Categories</h2><ul>	<li class="cat-item cat-item-7"><a href="http://brettbeauregard.com/blog/category/pid/">PID</a> (23)
<ul class="children">
	<li class="cat-item cat-item-31"><a href="http://brettbeauregard.com/blog/category/pid/coding/">Coding</a> (11)
</li>
	<li class="cat-item cat-item-33"><a href="http://brettbeauregard.com/blog/category/pid/front-end/">Front End</a> (2)
</li>
	<li class="cat-item cat-item-35"><a href="http://brettbeauregard.com/blog/category/pid/showcase/">Showcase</a> (4)
</li>
</ul>
</li>
	<li class="cat-item cat-item-5"><a href="http://brettbeauregard.com/blog/category/projects/">Projects</a> (40)
<ul class="children">
	<li class="cat-item cat-item-19"><a href="http://brettbeauregard.com/blog/category/projects/craft/">Craft</a> (6)
</li>
	<li class="cat-item cat-item-16"><a href="http://brettbeauregard.com/blog/category/projects/electronic/">Electronic</a> (12)
</li>
	<li class="cat-item cat-item-17"><a href="http://brettbeauregard.com/blog/category/projects/mechanical/">Mechanical</a> (26)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="http://brettbeauregard.com/blog/category/uncategorized/">Uncategorized</a> (5)
</li>
</ul></li><li><h2>Archives</h2>
				<ul>
					<li><a href="http://brettbeauregard.com/blog/2012/11/">November 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/09/">September 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/07/">July 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/06/">June 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/04/">April 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/03/">March 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/01/">January 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/12/">December 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/10/">October 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/09/">September 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/08/">August 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/07/">July 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/06/">June 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/05/">May 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/04/">April 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/09/">September 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/08/">August 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/07/">July 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/03/">March 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/11/">November 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/10/">October 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/09/">September 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/08/">August 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/07/">July 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/06/">June 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/05/">May 2009</a></li>
				</ul>
			</li>
					</ul>
	</div>
<hr>
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link somewhere on your blog is the best way; it's our only promotion or advertising. -->
	<p>
		Project  Blog is proudly powered by
		<a href="http://wordpress.org/">WordPress</a>
		<br><a href="http://brettbeauregard.com/blog/feed/">Entries (RSS)</a>
		and <a href="http://brettbeauregard.com/blog/comments/feed/">Comments (RSS)</a>.
		<!-- 51 queries. 0.408 seconds. -->
	</p>
</div>
</div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<script type="text/javascript" src="./02_files/shCore.js"></script>
<script type="text/javascript" src="./02_files/shBrushCss.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://brettbeauregard.com/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://brettbeauregard.com/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.defaults['wrap-lines'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./02_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./02_files/wp-embed.min.js"></script>


</body><iframe allowtransparency="true" frameborder="0" id="abs-top-frame" src="./02_files/top.html" style="position: fixed !important; z-index: 2147483647 !important; overflow: hidden !important; top: 0px !important; left: 0px !important; right: 0px !important; width: 138px !important; height: 13px !important; max-height: none !important; min-height: 0px !important; margin: 0px auto !important; padding: 0px !important; border: 0px !important; display: block !important; background-color: transparent !important;"></iframe></html>